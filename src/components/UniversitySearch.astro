---
import { Search } from '@lucide/astro';
---

<div class="w-full max-w-2xl mx-auto mb-8">
  {/* Search Input Container */}
  <div class="relative">
    <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
      <Search class="h-5 w-5 text-gray-400" />
    </div>
    <input
      type="text"
      id="search-input"
      class="block w-full pl-12 pr-4 py-4 text-base border-2 border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all shadow-sm hover:border-gray-300 placeholder-gray-400"
      placeholder="Buscar universidades por nombre o siglas..."
    />
  </div>

  {/* Results Count / No Results Message */}
  <div id="search-results-msg" class="text-center mt-4 hidden">
    <p class="text-sm text-gray-600">
      <span id="results-count"></span>
      <span id="no-results" class="text-red-600 hidden">
        No se encontraron universidades "<span id="search-term"></span>"
      </span>
    </p>
  </div>
</div>

<script>
    const searchInput = document.getElementById('search-input') as HTMLInputElement;
    const resultsMsg = document.getElementById('search-results-msg');
    const resultsCountSpan = document.getElementById('results-count');
    const noResultsSpan = document.getElementById('no-results');
    const searchTermSpan = document.getElementById('search-term');

    searchInput?.addEventListener('input', (e) => {
        const term = (e.target as HTMLInputElement).value.toLowerCase();
        
        const cards = document.querySelectorAll('.university-card-item'); 
        let visibleCount = 0;

        cards.forEach((card) => {
        const searchTerms = card.getAttribute('data-search-terms') || '';
        
        if (searchTerms.includes(term)) {
            card.classList.remove('hidden');
            visibleCount++;
        } else {
            card.classList.add('hidden');
        }
        });

        if (resultsMsg && resultsCountSpan && noResultsSpan && searchTermSpan) {
            if (term === '') {
                resultsMsg.classList.add('hidden');
            } else {
                resultsMsg.classList.remove('hidden');
                if (visibleCount === 0) {
                    resultsCountSpan.classList.add('hidden');
                    noResultsSpan.classList.remove('hidden');
                    searchTermSpan.textContent = term;
                } else {
                    noResultsSpan.classList.add('hidden');
                    resultsCountSpan.classList.remove('hidden');
                    resultsCountSpan.textContent = `Found ${visibleCount} ${visibleCount === 1 ? 'university' : 'universities'}`;
                }
            }
        }
    });
</script>